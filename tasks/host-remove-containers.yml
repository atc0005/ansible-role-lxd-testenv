---

# vim: ts=2:sw=2:et:ft=yaml
# -*- mode: yaml; indent-tabs-mode: nil; tab-width: 2 -*-
# code: language=yaml insertSpaces=true tabSize=2

# https://github.com/atc0005/ansible-playbook-lxd-testenv
# https://github.com/atc0005/ansible-role-lxd-testenv

# make sure all containers are running so that we can retrieve relevant
# info and then prune that info from the host (e.g., known_hosts, /etc/hosts)
# - name: Ensure containers are running so we can pull required details
#   import_tasks: containers-start.yml

- name: Stop containers
  delegate_to: localhost
  # Intended to allow external removal of containers without risk of entirely
  # breaking the removal process for other containers generated by this role.
  ignore_errors: true
  lxd_container:
    name: "{{ item }}"
    state: stopped
    timeout: 90
  with_items:
    - "{{ groups['all'] }}"
  when:
    - lxd_host_remove_containers
    - lxd_host_stop_containers_before_removal
  tags:
    - remove

- name: Delete containers
  delegate_to: localhost
  lxd_container:
    name: "{{ item }}"
    state: absent
    timeout: 90
  with_items:
    - "{{ groups['all'] }}"
  when: lxd_host_remove_containers
  tags:
    - remove

...
